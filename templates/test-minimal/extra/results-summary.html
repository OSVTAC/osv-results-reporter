{% extends "base.html" %}

{% block title %}Summary Results{% endblock %}

{% block content %}
  <p>
  {% with %}
    {% for headers, contest in election.contests_with_headers() %}

      {# First display any headers, if there are new headers. #}
      {% for level, header in headers %}
        {% if level == 1 %}
          <h3>{{ header.ballot_title|translate }}</h3>
        {% else %}
          <h4>{{ header.ballot_title|translate }}</h4>
        {% endif %}
      {% endfor %}

      {# Compute detailed results now so we can link to the results file below. #}
      {% set output_path = contest|contest_path("results-detail") %}

      {# Set options so the objects are available within the subtemplate. #}
      {% set options.contest = contest %}
      {% set options.headers = headers %}
      {% do subtemplate('results-detail.html', output_path) %}

    <p>{{ contest.ballot_title|translate}}
      {% if contest.ballot_subtitle %}
        - {{ contest.ballot_subtitle|translate }}
      {% endif %}
    </p>
    {% if contest.vote_for_msg %}
      <p>
        {{ contest.vote_for_msg|translate }}
      </p>
    {% endif %}
    <p>{{ contest.precincts_reporting }} of {{ contest.total_precincts}} Precincts Reporting ({{ contest.precincts_reporting|format_percent2(contest.total_precincts) }})
    {% if contest.is_rcv %}
      {% set rcv_path = contest|contest_path("results-rcv") %}
      {% do subtemplate('results-rcv.html', rcv_path) %}
      <a href="{{ rcv_path }}">[RCV rounds]</a>
    {% endif %}
    <a href="{{ output_path }}">[Detailed results]</a>
    </p>
    {% if contest.is_rcv %}
      <table>
        <thead>
          <tr>
            <th>Candidate</th>
            <th>Votes</th>
            <th>Round</th>
            <th>Percent</th>
          </tr>
        </thead>
        {# Pass the id of the ResultStatType object corresponding to continuing ballots. #}
        {% for choice, round in contest.rcv_summary("RSTot") %}
          {% set vote_total = contest.get_round_total(choice, round) %}
          <tr>
            <td>{{ choice.ballot_title|translate }}</td>
            <td>{{ vote_total }}</td>
            <td>{{ round }}</td>
            <td>{{ vote_total|format_percent2(contest.get_round_stat("RSTot", round)) }}</td>
          </tr>
        {% endfor %}
      </table>
    {% else %}
    <table>
      <thead><tr><th>&nbsp;</th>
      {% for vg in contest.voting_groups_from_idlist() %}
      <th>{{ vg.heading }}</th>
      {% endfor %}
      </tr></thead>
      {% for choice in contest.choices %}
        <tr><td>{{ choice.ballot_title|translate }}</td>
        {% for v in contest.summary_results(choice) %}
        <td>{{ v }}</td>
        {% endfor %}
        </tr>
      {% endfor %}
      {% for result_stat in contest.result_stats %}
        <tr><td>{{ result_stat.heading }}</td>
        {% for v in contest.summary_results(result_stat) %}
        <td>{{ v|format_number}}</td>
        {% endfor %}
        </tr>
      {% endfor %}
    </table>
    {% endif %}
    {% endfor %}
  {% endwith %}
{% endblock %}
